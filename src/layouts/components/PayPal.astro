---
const PAYPAL_CLIENT_ID =
  import.meta.env.PUBLIC_PAYPAL_CLIENT_ID || import.meta.env.PAYPAL_CLIENT_ID;
console.log(
  "PayPal Client ID (first 10 chars):",
  PAYPAL_CLIENT_ID?.substring(0, 10),
);
---

<div class="paypal-checkout-container max-w-4xl mx-auto p-4">
  <!-- Product Catalog -->
  <div class="product-catalog mb-8">
    <h2 class="text-2xl font-bold mb-4">Available Products</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      <!-- Example products - customize these -->
      <div class="product-card border rounded-lg p-4 shadow-sm">
        <h3 class="font-semibold text-lg">Membership - Individual</h3>
        <p class="text-gray-600 my-2">Annual membership for one person</p>
        <p class="text-xl font-bold mb-3">$50.00</p>
        <div class="flex gap-2">
          <input
            type="number"
            id="qty-membership-individual"
            value="1"
            min="1"
            class="w-16 border rounded px-2 py-1 text-center"
          />
          <button
            onclick="addToCart('Membership - Individual', 50.00, parseInt(document.getElementById('qty-membership-individual').value))"
            class="btn btn-primary flex-1 bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700"
          >
            Add to Cart
          </button>
        </div>
      </div>

      <div class="product-card border rounded-lg p-4 shadow-sm">
        <h3 class="font-semibold text-lg">Membership - Family</h3>
        <p class="text-gray-600 my-2">Annual membership for family</p>
        <p class="text-xl font-bold mb-3">$75.00</p>
        <div class="flex gap-2">
          <input
            type="number"
            id="qty-membership-family"
            value="1"
            min="1"
            class="w-16 border rounded px-2 py-1 text-center"
          />
          <button
            onclick="addToCart('Membership - Family', 75.00, parseInt(document.getElementById('qty-membership-family').value))"
            class="btn btn-primary flex-1 bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700"
          >
            Add to Cart
          </button>
        </div>
      </div>

      <div class="product-card border rounded-lg p-4 shadow-sm">
        <h3 class="font-semibold text-lg">Event Ticket</h3>
        <p class="text-gray-600 my-2">Ticket to upcoming event</p>
        <p class="text-xl font-bold mb-3">$25.00</p>
        <div class="flex gap-2">
          <input
            type="number"
            id="qty-event-ticket"
            value="1"
            min="1"
            class="w-16 border rounded px-2 py-1 text-center"
          />
          <button
            onclick="addToCart('Event Ticket', 25.00, parseInt(document.getElementById('qty-event-ticket').value))"
            class="btn btn-primary flex-1 bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700"
          >
            Add to Cart
          </button>
        </div>
      </div>

      <div class="product-card border rounded-lg p-4 shadow-sm">
        <h3 class="font-semibold text-lg">Competition Entry</h3>
        <p class="text-gray-600 my-2">Entry fee for brewing competition</p>
        <p class="text-xl font-bold mb-3">$10.00</p>
        <div class="flex gap-2">
          <input
            type="number"
            id="qty-competition-entry"
            value="1"
            min="1"
            class="w-16 border rounded px-2 py-1 text-center"
          />
          <button
            onclick="addToCart('Competition Entry', 10.00, parseInt(document.getElementById('qty-competition-entry').value))"
            class="btn btn-primary flex-1 bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700"
          >
            Add to Cart
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Shopping Cart -->
  <div class="shopping-cart border rounded-lg p-6 bg-gray-50 mb-4">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-2xl font-bold">Shopping Cart</h2>
      <button
        onclick="clearCart()"
        class="text-sm text-red-600 hover:text-red-800"
      >
        Clear Cart
      </button>
    </div>

    <div id="cart-items" class="mb-4">
      <p class="text-gray-500">Your cart is empty</p>
    </div>

    <div class="border-t pt-4">
      <div class="flex justify-between items-center text-xl font-bold">
        <span>Total:</span>
        <span id="cart-total">$0.00</span>
      </div>
    </div>
  </div>

  <!-- PayPal Button -->
  <div
    id="paypal-button-container"
    class="paypal-button-container"
    style="display: none;"
  >
  </div>

  <!-- Result Message -->
  <div id="result-message" class="mt-4 p-4 rounded"></div>
</div>

<script is:inline define:vars={{ PAYPAL_CLIENT_ID }}>
  const script = document.createElement("script");
  script.src = `https://www.paypal.com/sdk/js?client-id=${PAYPAL_CLIENT_ID}&buyer-country=US&currency=USD&components=buttons&enable-funding=venmo`;
  script.onload = () => {
    // Load the cart script after PayPal SDK is loaded
    const cartScript = document.createElement("script");
    cartScript.src = "/scripts/paypal_cart.js";
    document.body.appendChild(cartScript);
  };
  document.body.appendChild(script);
</script>
